<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sedimentary Geochemistry - Exam Simulation: Permo-Triassic Boundary</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/docx/7.8.2/docx.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/FileSaver.js/2.0.5/FileSaver.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        * {
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Georgia', serif;
            line-height: 1.6;
            color: #333;
            max-width: 1000px;
            margin: 0 auto;
            padding: 20px;
            background-color: #f7f9fc;
        }

        /* Password Overlay */
        .password-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(135deg, #1a5276, #16a085);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 10000;
        }

        .password-overlay.hidden {
            display: none;
        }

        /* Time-Lock Overlay */
        .timelock-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(135deg, #2c3e50, #34495e);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 10001;
        }

        .timelock-overlay.hidden {
            display: none;
        }

        .timelock-box {
            background: white;
            padding: 50px;
            border-radius: 15px;
            box-shadow: 0 10px 40px rgba(0,0,0,0.3);
            text-align: center;
            max-width: 500px;
        }

        .timelock-box .lock-icon {
            font-size: 4em;
            margin-bottom: 20px;
        }

        .timelock-box h2 {
            color: #2c3e50;
            margin-bottom: 15px;
        }

        .timelock-box .countdown {
            font-size: 2em;
            font-weight: bold;
            color: #e74c3c;
            font-family: 'Courier New', monospace;
            margin: 25px 0;
            padding: 20px;
            background: #f8f9fa;
            border-radius: 10px;
        }

        .timelock-box p {
            color: #666;
            margin-bottom: 10px;
        }

        .timelock-box .start-time {
            font-weight: bold;
            color: #16a085;
            font-size: 1.2em;
        }

        .password-box {
            background: white;
            padding: 40px;
            border-radius: 15px;
            box-shadow: 0 10px 40px rgba(0,0,0,0.3);
            text-align: center;
            max-width: 450px;
        }

        .password-box h2 {
            color: #16a085;
            margin-bottom: 10px;
        }

        .password-box p {
            color: #666;
            margin-bottom: 20px;
        }

        .password-box input {
            width: 100%;
            padding: 12px;
            font-size: 1.1em;
            border: 2px solid #ddd;
            border-radius: 8px;
            margin-bottom: 15px;
        }

        .password-box input:focus {
            outline: none;
            border-color: #16a085;
        }

        .password-box button {
            width: 100%;
            padding: 12px;
            font-size: 1.1em;
            background: linear-gradient(135deg, #16a085, #27ae60);
            color: white;
            border: none;
            border-radius: 8px;
            cursor: pointer;
        }

        .password-box button:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(22, 160, 133, 0.4);
        }

        .error-message {
            color: #e74c3c;
            margin-top: 10px;
            font-weight: bold;
        }

        /* Timer Bar */
        .timer-bar {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            background: linear-gradient(135deg, #2c3e50, #34495e);
            color: white;
            padding: 15px 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            z-index: 1000;
            box-shadow: 0 2px 10px rgba(0,0,0,0.2);
        }

        .timer-bar.hidden {
            display: none;
        }

        .timer-display {
            font-size: 1.5em;
            font-weight: bold;
            font-family: 'Courier New', monospace;
        }

        .timer-display.warning {
            color: #f39c12;
            animation: pulse 1s infinite;
        }

        .timer-display.critical {
            color: #e74c3c;
            animation: pulse 0.5s infinite;
        }

        .timer-display.grace {
            color: #9b59b6;
        }

        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }

        .timer-status {
            font-size: 0.9em;
            opacity: 0.9;
        }

        .submit-timer-btn {
            background: #27ae60;
            color: white;
            border: none;
            padding: 10px 25px;
            border-radius: 5px;
            cursor: pointer;
            font-weight: bold;
        }

        .submit-timer-btn:hover {
            background: #2ecc71;
        }

        /* Main Content */
        .main-content {
            display: none;
            margin-top: 80px;
        }

        .main-content.visible {
            display: block;
        }

        /* Header */
        .header {
            background: linear-gradient(135deg, #16a085, #27ae60);
            color: white;
            padding: 30px;
            border-radius: 10px;
            margin-bottom: 20px;
            text-align: center;
        }

        .header h1 {
            margin: 0;
            font-size: 2em;
            font-weight: 300;
        }

        .header .subtitle {
            margin-top: 10px;
            opacity: 0.9;
            font-size: 1.2em;
        }

        .header .exam-info {
            margin-top: 15px;
            padding-top: 15px;
            border-top: 1px solid rgba(255,255,255,0.3);
            font-size: 0.95em;
        }

        /* Reference Bar */
        .reference-bar {
            background: #ecf0f1;
            padding: 15px 20px;
            border-radius: 8px;
            margin-bottom: 20px;
            border-left: 4px solid #16a085;
            display: flex;
            justify-content: space-between;
            flex-wrap: wrap;
            gap: 10px;
        }

        .reference-bar span {
            color: #555;
        }

        /* Student Info */
        .student-info {
            background: white;
            padding: 25px;
            border-radius: 10px;
            margin-bottom: 25px;
            border-left: 4px solid #9b59b6;
            box-shadow: 0 2px 10px rgba(0,0,0,0.05);
        }

        .student-info h3 {
            color: #8e44ad;
            margin-top: 0;
            margin-bottom: 20px;
        }

        .info-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 20px;
        }

        .info-field label {
            display: block;
            font-weight: bold;
            margin-bottom: 5px;
            color: #555;
        }

        .info-field input {
            width: 100%;
            padding: 10px;
            border: 2px solid #ddd;
            border-radius: 5px;
            font-size: 1em;
        }

        .info-field input:focus {
            outline: none;
            border-color: #9b59b6;
        }

        /* Sections */
        .section {
            background: white;
            padding: 25px;
            border-radius: 10px;
            margin-bottom: 25px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.05);
        }

        .section-title {
            background: linear-gradient(135deg, #16a085, #27ae60);
            color: white;
            padding: 12px 20px;
            border-radius: 8px;
            font-size: 1.2em;
            font-weight: bold;
            margin-bottom: 20px;
        }

        /* Background Section */
        .background-section {
            background: #eaf2f8;
            border-left: 4px solid #3498db;
        }

        .background-section .section-title {
            background: linear-gradient(135deg, #3498db, #2980b9);
        }

        /* Figures */
        .figure-container {
            margin: 20px 0;
            text-align: center;
        }

        .figure-container img {
            max-width: 100%;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }

        .figure-caption {
            margin-top: 10px;
            font-style: italic;
            color: #666;
            font-size: 0.95em;
        }

        /* Questions */
        .question-block {
            margin: 20px 0;
            padding: 20px;
            background: #f8f9fa;
            border-radius: 8px;
            border-left: 4px solid #16a085;
        }

        .question-title {
            font-weight: bold;
            color: #16a085;
            margin-bottom: 15px;
            font-size: 1.1em;
        }

        .sub-question {
            margin: 15px 0;
            padding: 15px;
            background: white;
            border-radius: 5px;
            border: 1px solid #e0e0e0;
        }

        .sub-question-title {
            font-weight: bold;
            color: #2c3e50;
            margin-bottom: 10px;
        }

        /* Data Tables */
        .data-table {
            width: 100%;
            border-collapse: collapse;
            margin: 20px 0;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
        }

        .data-table th {
            background: #16a085;
            color: white;
            padding: 12px;
            text-align: center;
        }

        .data-table td {
            padding: 10px;
            text-align: center;
            border: 1px solid #ddd;
        }

        .data-table tr:nth-child(even) {
            background: #f8f9fa;
        }

        .data-table tr:hover {
            background: #e8f8f5;
        }

        /* Equation Box */
        .equation-box {
            background: #e8f8f5;
            border: 2px solid #16a085;
            border-radius: 8px;
            padding: 20px;
            margin: 15px 0;
            font-family: 'Courier New', monospace;
        }

        .equation-title {
            font-weight: bold;
            color: #16a085;
            margin-bottom: 10px;
            font-family: 'Georgia', serif;
        }

        /* Note Boxes */
        .info-note {
            background: #fff9e6;
            border-left: 4px solid #f39c12;
            padding: 15px;
            margin: 15px 0;
            border-radius: 0 8px 8px 0;
        }

        .concept-box {
            background: #eaf2f8;
            border-left: 4px solid #3498db;
            padding: 15px;
            margin: 15px 0;
            border-radius: 0 8px 8px 0;
        }

        /* Answer Areas */
        .calculation-label {
            font-weight: bold;
            color: #16a085;
            margin: 15px 0 8px 0;
        }

        .calculation-area {
            width: 100%;
            min-height: 150px;
            padding: 15px;
            border: 2px solid #d5d8dc;
            border-radius: 8px;
            font-family: 'Courier New', monospace;
            font-size: 0.95em;
            resize: vertical;
        }

        .answer-area {
            width: 100%;
            min-height: 120px;
            padding: 15px;
            border: 2px solid #d5d8dc;
            border-radius: 8px;
            font-family: 'Georgia', serif;
            font-size: 1em;
            resize: vertical;
        }

        .calculation-area:focus, .answer-area:focus {
            outline: none;
            border-color: #16a085;
            box-shadow: 0 0 5px rgba(22, 160, 133, 0.3);
        }

        /* Calculator Tool */
        .calculator-container {
            position: fixed;
            bottom: 20px;
            right: 20px;
            z-index: 500;
        }

        .calculator-toggle {
            background: linear-gradient(135deg, #9b59b6, #8e44ad);
            color: white;
            border: none;
            padding: 15px 20px;
            border-radius: 50px;
            cursor: pointer;
            font-size: 1em;
            box-shadow: 0 4px 15px rgba(155, 89, 182, 0.4);
        }

        .calculator-toggle:hover {
            transform: translateY(-2px);
        }

        .calculator-panel {
            display: none;
            position: fixed;
            bottom: 80px;
            right: 20px;
            width: 380px;
            background: white;
            border-radius: 15px;
            box-shadow: 0 10px 40px rgba(0,0,0,0.2);
            overflow: hidden;
        }

        .calculator-panel.active {
            display: block;
        }

        .calc-header {
            background: linear-gradient(135deg, #9b59b6, #8e44ad);
            color: white;
            padding: 15px;
            font-weight: bold;
        }

        .calc-body {
            padding: 15px;
        }

        .calc-display {
            width: 100%;
            padding: 15px;
            font-size: 1.3em;
            font-family: 'Courier New', monospace;
            border: 2px solid #ddd;
            border-radius: 8px;
            margin-bottom: 15px;
            text-align: right;
        }

        .calc-tabs {
            display: flex;
            gap: 5px;
            margin-bottom: 15px;
        }

        .calc-tab {
            flex: 1;
            padding: 8px;
            background: #f0f0f0;
            border: none;
            cursor: pointer;
            border-radius: 5px;
            font-size: 0.85em;
        }

        .calc-tab.active {
            background: #9b59b6;
            color: white;
        }

        .calc-buttons {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 8px;
        }

        .calc-btn {
            padding: 12px;
            font-size: 1em;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            background: #f0f0f0;
        }

        .calc-btn:hover {
            background: #e0e0e0;
        }

        .calc-btn.operator {
            background: #16a085;
            color: white;
        }

        .calc-btn.equals {
            background: #27ae60;
            color: white;
            grid-column: span 2;
        }

        .calc-btn.function {
            background: #3498db;
            color: white;
            font-size: 0.85em;
        }

        .calc-btn.clear {
            background: #e74c3c;
            color: white;
        }

        .isotope-functions {
            display: none;
            margin-top: 10px;
        }

        .isotope-functions.active {
            display: block;
        }

        .isotope-func-btn {
            width: 100%;
            padding: 10px;
            margin: 5px 0;
            background: linear-gradient(135deg, #16a085, #27ae60);
            color: white;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-size: 0.9em;
            text-align: left;
        }

        .isotope-func-btn:hover {
            opacity: 0.9;
        }

        .calc-input-group {
            display: none;
            margin-top: 15px;
            padding: 15px;
            background: #f8f9fa;
            border-radius: 8px;
        }

        .calc-input-group.active {
            display: block;
        }

        .calc-input-group label {
            display: block;
            margin-bottom: 5px;
            font-weight: bold;
            font-size: 0.9em;
        }

        .calc-input-group input {
            width: 100%;
            padding: 8px;
            margin-bottom: 10px;
            border: 1px solid #ddd;
            border-radius: 5px;
        }

        .calc-result {
            margin-top: 10px;
            padding: 10px;
            background: #e8f8f5;
            border-radius: 5px;
            font-family: 'Courier New', monospace;
        }

        /* Chart Generator */
        .chart-container {
            margin: 20px 0;
            padding: 20px;
            background: #f8f9fa;
            border-radius: 8px;
        }

        .chart-container h4 {
            color: #16a085;
            margin-bottom: 15px;
        }

        .chart-data-input {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
            margin-bottom: 15px;
        }

        .chart-data-input textarea {
            width: 100%;
            height: 100px;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 5px;
            font-family: 'Courier New', monospace;
            font-size: 0.9em;
        }

        .chart-canvas-container {
            background: white;
            padding: 15px;
            border-radius: 8px;
            margin-top: 15px;
        }

        /* Export Buttons */
        .export-section {
            background: white;
            padding: 25px;
            border-radius: 10px;
            margin-top: 30px;
            text-align: center;
        }

        .export-buttons {
            display: flex;
            justify-content: center;
            gap: 15px;
            flex-wrap: wrap;
        }

        .export-btn {
            padding: 12px 25px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-size: 1em;
            font-weight: bold;
            color: white;
            transition: all 0.3s ease;
        }

        .export-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0,0,0,0.2);
        }

        .export-btn.submit {
            background: linear-gradient(135deg, #27ae60, #2ecc71);
        }

        .export-btn.word {
            background: linear-gradient(135deg, #3498db, #2980b9);
        }

        .export-btn.copy {
            background: linear-gradient(135deg, #9b59b6, #8e44ad);
        }

        /* Loading Overlay */
        .loading-overlay {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.7);
            z-index: 9999;
            justify-content: center;
            align-items: center;
        }

        .loading-overlay.active {
            display: flex;
        }

        .loading-box {
            background: white;
            padding: 30px 50px;
            border-radius: 10px;
            text-align: center;
        }

        .spinner {
            width: 50px;
            height: 50px;
            border: 5px solid #f3f3f3;
            border-top: 5px solid #16a085;
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin: 0 auto 15px;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        /* Watermark */
        .watermark {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%) rotate(-45deg);
            font-size: 72px;
            color: rgba(22, 160, 133, 0.06);
            font-weight: bold;
            pointer-events: none;
            z-index: 1;
            white-space: nowrap;
            user-select: none;
        }

        .watermark.hidden {
            display: none;
        }

        /* Responsive */
        @media (max-width: 768px) {
            .info-grid {
                grid-template-columns: 1fr;
            }
            
            .timer-bar {
                flex-direction: column;
                gap: 10px;
                text-align: center;
            }
            
            .calculator-panel {
                width: 95%;
                right: 2.5%;
            }
        }
    </style>
</head>
<body>
    <!-- Time-Lock Overlay (shown first if exam not yet available) -->
    <div class="timelock-overlay" id="timelockOverlay">
        <div class="timelock-box">
            <div class="lock-icon">üîí</div>
            <h2>Exam Not Yet Available</h2>
            <p>This exam will become available at:</p>
            <p class="start-time" id="startTimeDisplay">December 16, 2025 at 16:15</p>
            <div class="countdown" id="countdownDisplay">--:--:--</div>
            <p style="font-size: 0.9em; color: #888;">Please return at the scheduled time.</p>
            <p style="margin-top: 20px;"><strong>GeoZentrum Nordbayern</strong><br>FAU Erlangen-N√ºrnberg</p>
        </div>
    </div>

    <!-- Password Overlay (shown after time-lock passes) -->
    <div class="password-overlay hidden" id="passwordOverlay">
        <div class="password-box">
            <h2>üî¨ Exam Simulation</h2>
            <h3>Sedimentary Geochemistry</h3>
            <p>Permo-Triassic Boundary Case Study</p>
            <p style="font-size: 0.9em; color: #888;">Enter the password provided by your instructor</p>
            <input type="password" id="passwordInput" placeholder="Enter password..." onkeypress="if(event.key==='Enter')checkPassword()">
            <button onclick="checkPassword()">Start Exam</button>
            <div class="error-message" id="errorMessage"></div>
        </div>
    </div>

    <!-- Timer Bar -->
    <div class="timer-bar hidden" id="timerBar">
        <div>
            <div class="timer-status" id="timerStatus">Exam in Progress</div>
            <div class="timer-display" id="timerDisplay">01:45:00</div>
        </div>
        <div style="text-align: center;">
            <strong>PTB Exam Simulation</strong><br>
            <span style="font-size: 0.85em;">Auto-save enabled</span>
        </div>
        <button class="submit-timer-btn" onclick="submitExam()">Submit Exam</button>
    </div>

    <!-- Watermark -->
    <div class="watermark hidden" id="watermark"></div>

    <!-- Main Content -->
    <div class="main-content" id="mainContent">
        <!-- Header -->
        <div class="header">
            <h1>SEDIMENTARY GEOCHEMISTRY</h1>
            <div class="subtitle">Exam Simulation: The Permo-Triassic Mass Extinction</div>
            <div class="exam-info">
                <strong>Total Points:</strong> 100 | <strong>Time:</strong> 1 hour 45 minutes (+5 min grace period)<br>
                Winter Semester 2025-26 | Friedrich-Alexander-Universit√§t Erlangen-N√ºrnberg
            </div>
        </div>

        <!-- Reference Bar -->
        <div class="reference-bar">
            <span><strong>Course:</strong> Sedimentary Geochemistry (MSc)</span>
            <span><strong>Instructor:</strong> PD Dr. Luca Caracciolo</span>
            <span><strong>Contact:</strong> <a href="/cdn-cgi/l/email-protection" class="__cf_email__" data-cfemail="79150c1a18571a180b181a1a10161516391f180c571d1c">[email&#160;protected]</a></span>
        </div>

        <!-- Student Information -->
        <div class="student-info">
            <h3>üìã Student Information</h3>
            <div class="info-grid">
                <div class="info-field">
                    <label>Full Name: *</label>
                    <input type="text" id="studentName" placeholder="Enter your full name" oninput="updateWatermark()">
                </div>
                <div class="info-field">
                    <label>Email: *</label>
                    <input type="email" id="studentEmail" placeholder="your.email@fau.de">
                </div>
                <div class="info-field">
                    <label>Student ID: *</label>
                    <input type="text" id="studentId" placeholder="e.g., 12345678">
                </div>
                <div class="info-field">
                    <label>Date:</label>
                    <input type="date" id="submissionDate">
                </div>
            </div>
        </div>

        <!-- PART 0: GEOLOGICAL BACKGROUND -->
        <div class="section background-section">
            <div class="section-title">GEOLOGICAL BACKGROUND: The Permo-Triassic Mass Extinction (Read: ~5 minutes)</div>
            
            <p>The <strong>Permo-Triassic mass extinction (PTME)</strong> at ~252 Ma represents the largest biotic crisis in Earth history, eliminating approximately <strong>90% of marine species</strong> and <strong>70% of terrestrial vertebrate species</strong>. This event, often called the "Great Dying," far exceeds other major extinctions in magnitude.</p>

            <div class="figure-container">
                <p><em>[Figure 1: Extinction magnitude comparison and paleogeography - showing Pangea, Panthalassa, Siberian Traps location, and Meishan GSSP]</em></p>
            </div>

            <div class="concept-box">
                <strong>üåç Paleogeographic Setting:</strong><br>
                The PTB world consisted of a single supercontinent (<strong>Pangea</strong>) surrounded by the vast <strong>Panthalassa</strong> ocean, with the <strong>Paleo-Tethys</strong> and <strong>Neo-Tethys</strong> forming a giant gulf. The <strong>Siberian Traps Large Igneous Province</strong> erupted 2-7 million km¬≥ of basalt in the northern hemisphere during this interval.
            </div>

            <p>The biological crisis resulted from cascading environmental changes triggered by volcanic emissions from the Siberian Traps, including:</p>
            <ul>
                <li><strong>Massive CO‚ÇÇ release</strong> ‚Üí Global warming (up to ~10¬∞C increase)</li>
                <li><strong>SO‚ÇÇ emissions</strong> ‚Üí Acid rain, vegetation die-off</li>
                <li><strong>Thermogenic carbon release</strong> ‚Üí Additional greenhouse forcing from contact metamorphism</li>
                <li><strong>Ocean acidification</strong> ‚Üí Carbonate dissolution, calcifier extinction</li>
                <li><strong>Oceanic anoxia</strong> ‚Üí Expansion of oxygen-depleted waters</li>
            </ul>

            <div class="figure-container">
                <p><em>[Figure 2: Stratigraphic framework showing conodont biostratigraphy, two extinction pulses, and species richness decline across the PTB at Meishan (South China) and Dolomites (Italy)]</em></p>
            </div>

            <p>The stratigraphic record at the Global Stratotype Section and Point (GSSP) at <strong>Meishan, South China</strong> reveals <strong>two distinct extinction pulses</strong>:</p>
            <ul>
                <li><strong>1st pulse:</strong> ~251.94 Ma (latest Permian, C. meishanensis Zone)</li>
                <li><strong>2nd pulse:</strong> ~251.88 Ma (earliest Triassic, I. isarcica Zone)</li>
            </ul>

            <p>Geochemical proxies provide independent evidence for environmental changes during this interval. The figure below shows compiled proxy data from multiple locations:</p>

            <div class="figure-container">
                <p><em>[Figure 3: Multi-proxy geochemical compilation showing Œ¥¬π¬≥C_carbonate, Œ¥¬π‚Å∏O_apatite (conodonts), Œ¥¬≤¬≥‚Å∏U, Œ¥¬≥‚Å¥S_CAS, Œ¥¬π¬πB_brachiopod, and Œ¥‚Å¥‚Å¥/‚Å¥‚Å∞Ca_apatite across the PTB. Blue shaded interval = marine extinction interval.]</em></p>
            </div>

            <p>In this exam, you will analyze these proxy records to reconstruct the environmental conditions during Earth's greatest mass extinction.</p>
        </div>

        <!-- PART 1: CARBON ISOTOPES -->
        <div class="section">
            <div class="section-title">PART 1: CARBON ISOTOPES (25 points) ‚Äî Estimated time: 25 minutes</div>

            <div class="question-block">
                <div class="question-title">Question 1.1: The Carbon Isotope Excursion (15 points)</div>
                
                <p>The Œ¥¬π¬≥C record across the PTB shows a pronounced <strong>negative carbon isotope excursion (CIE)</strong>. Using the data from the Meishan section provided below, answer the following questions.</p>

                <table class="data-table">
                    <thead>
                        <tr>
                            <th>Sample</th>
                            <th>Age (Ma)</th>
                            <th>Conodont Zone</th>
                            <th>Œ¥¬π¬≥C_carb (‚Ä∞ VPDB)</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr><td>MS-1</td><td>252.10</td><td>C. yini</td><td>+3.8</td></tr>
                        <tr><td>MS-2</td><td>252.00</td><td>C. yini</td><td>+3.2</td></tr>
                        <tr><td>MS-3</td><td>251.95</td><td>C. meishanensis</td><td>+1.5</td></tr>
                        <tr><td>MS-4</td><td>251.92</td><td>H. changxingensis</td><td>-0.8</td></tr>
                        <tr><td>MS-5</td><td>251.90</td><td>H. parvus (PTB)</td><td>-2.8</td></tr>
                        <tr><td>MS-6</td><td>251.88</td><td>I. staeschei</td><td>-1.5</td></tr>
                        <tr><td>MS-7</td><td>251.85</td><td>I. isarcica</td><td>+0.2</td></tr>
                    </tbody>
                </table>

                <div class="sub-question">
                    <div class="sub-question-title">Part A (5 points): Calculate the magnitude of the CIE</div>
                    <p>Calculate the total magnitude of the negative carbon isotope excursion (ŒîŒ¥¬π¬≥C) from the pre-excursion baseline to the minimum value. Express your answer in per mil (‚Ä∞).</p>
                    
                    <div class="calculation-label">üíª CALCULATION:</div>
                    <textarea class="calculation-area" id="p1_1a_calc" placeholder="Show your calculation:
- Pre-excursion baseline Œ¥¬π¬≥C = ...
- Minimum Œ¥¬π¬≥C = ...
- ŒîŒ¥¬π¬≥C = ..."></textarea>
                </div>

                <div class="sub-question">
                    <div class="sub-question-title">Part B (10 points): Interpretation of the CIE</div>
                    <p>The negative CIE requires addition of isotopically <strong>light carbon</strong> (low Œ¥¬π¬≥C) to the ocean-atmosphere system. Several sources have been proposed:</p>
                    <ul>
                        <li><strong>Volcanic CO‚ÇÇ:</strong> Œ¥¬π¬≥C ‚âà -5‚Ä∞</li>
                        <li><strong>Thermogenic methane/CO‚ÇÇ:</strong> Œ¥¬π¬≥C ‚âà -25‚Ä∞ to -40‚Ä∞</li>
                        <li><strong>Methane hydrate dissociation:</strong> Œ¥¬π¬≥C ‚âà -60‚Ä∞</li>
                        <li><strong>Terrestrial biomass oxidation:</strong> Œ¥¬π¬≥C ‚âà -25‚Ä∞</li>
                    </ul>
                    
                    <p>Given the magnitude of the CIE you calculated, explain which carbon source(s) are most consistent with the observed excursion. Consider: (1) the isotopic composition of each source, (2) the amount of carbon required, and (3) the geological context of the Siberian Traps eruption.</p>
                    
                    <div class="calculation-label">üìù YOUR INTERPRETATION:</div>
                    <textarea class="answer-area" id="p1_1b" placeholder="Write your interpretation here (150-200 words). Consider:
- Which source(s) can explain the magnitude?
- What combination of sources is geologically plausible?
- How does this relate to Siberian Traps volcanism?"></textarea>
                </div>
            </div>

            <div class="question-block">
                <div class="question-title">Question 1.2: Œ¥¬π¬≥C_carbonate vs Œ¥¬π¬≥C_organic (10 points)</div>
                
                <p>At some PTB sections, the Œ¥¬π¬≥C_carbonate and Œ¥¬π¬≥C_TOC (total organic carbon) records show <strong>non-parallel trends</strong>. For example, at Meishan, the organic carbon record shows a larger negative excursion than the carbonate record.</p>

                <div class="sub-question">
                    <div class="sub-question-title">Full Question (10 points)</div>
                    <p>Explain <strong>two mechanisms</strong> that could cause Œ¥¬π¬≥C_carbonate and Œ¥¬π¬≥C_TOC to show different patterns across the same stratigraphic interval. For each mechanism, explain the underlying process.</p>
                    
                    <div class="calculation-label">üìù YOUR ANSWER:</div>
                    <textarea class="answer-area" id="p1_2" placeholder="Mechanism 1: ...

Mechanism 2: ...

(Consider: changes in organic matter source, productivity changes, diagenesis, etc.)"></textarea>
                </div>
            </div>
        </div>

        <!-- PART 2: OXYGEN ISOTOPES & TEMPERATURE -->
        <div class="section">
            <div class="section-title">PART 2: OXYGEN ISOTOPES & TEMPERATURE (30 points) ‚Äî Estimated time: 30 minutes</div>

            <div class="question-block">
                <div class="question-title">Question 2.1: Paleotemperature Calculations (20 points)</div>
                
                <p>The table below shows Œ¥¬π‚Å∏O values measured from <strong>conodont apatite</strong> across the PTB interval. These biogenic phosphates record the isotopic composition of seawater at the time of formation.</p>

                <table class="data-table">
                    <thead>
                        <tr>
                            <th>Sample</th>
                            <th>Age (Ma)</th>
                            <th>Conodont Zone</th>
                            <th>Œ¥¬π‚Å∏O_apatite (‚Ä∞ VSMOW)</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr><td>CON-1</td><td>252.00</td><td>C. yini</td><td>20.8</td></tr>
                        <tr><td>CON-2</td><td>251.95</td><td>C. meishanensis</td><td>19.5</td></tr>
                        <tr><td>CON-3</td><td>251.92</td><td>H. changxingensis</td><td>18.2</td></tr>
                        <tr><td>CON-4</td><td>251.90</td><td>H. parvus (PTB)</td><td>17.5</td></tr>
                        <tr><td>CON-5</td><td>251.85</td><td>I. isarcica</td><td>17.8</td></tr>
                    </tbody>
                </table>

                <div class="equation-box">
                    <div class="equation-title">Phosphate-Water Oxygen Isotope Thermometer (L√©cuyer et al., 2013):</div>
                    T(¬∞C) = 117.4 - 4.50 √ó (Œ¥¬π‚Å∏O_phosphate - Œ¥¬π‚Å∏O_water)
                    <br><br>
                    <em>Where Œ¥¬π‚Å∏O_phosphate and Œ¥¬π‚Å∏O_water are both in ‚Ä∞ VSMOW</em>
                </div>

                <div class="info-note">
                    <strong>‚ö†Ô∏è IMPORTANT - Seawater Œ¥¬π‚Å∏O Assumption:</strong><br>
                    For an <strong>ice-free world</strong> like the Permo-Triassic, assume Œ¥¬π‚Å∏O_seawater = <strong>-1.0‚Ä∞ VSMOW</strong>.<br>
                    This is different from modern seawater (0‚Ä∞ VSMOW) because there are no ice sheets storing ¬π‚Å∂O-depleted water.
                </div>

                <div class="sub-question">
                    <div class="sub-question-title">Part A (12 points): Calculate paleotemperatures</div>
                    <p>Using the L√©cuyer et al. equation and the assumed seawater Œ¥¬π‚Å∏O, calculate the sea surface temperature for <strong>each sample</strong>. Show your work for at least TWO samples, then tabulate all results.</p>
                    
                    <div class="calculation-label">üíª CALCULATIONS:</div>
                    <textarea class="calculation-area" id="p2_1a_calc" placeholder="Sample CON-1:
Œ¥¬π‚Å∏O_phosphate = 20.8‚Ä∞ VSMOW
Œ¥¬π‚Å∏O_water = -1.0‚Ä∞ VSMOW (ice-free world)
T = 117.4 - 4.50 √ó (20.8 - (-1.0))
T = 117.4 - 4.50 √ó (21.8)
T = ...

Sample CON-4:
...

RESULTS TABLE:
Sample | Age (Ma) | T (¬∞C)
CON-1  | 252.00   | ...
..."></textarea>
                </div>

                <div class="sub-question">
                    <div class="sub-question-title">Part B (8 points): Temperature interpretation</div>
                    <p>Based on your calculated temperatures:</p>
                    <ol>
                        <li>What is the total magnitude of warming across the PTB interval?</li>
                        <li>How do these temperatures compare to modern tropical sea surface temperatures (~27-29¬∞C)?</li>
                        <li>What are the implications for marine life during the extinction?</li>
                    </ol>
                    
                    <div class="calculation-label">üìù YOUR INTERPRETATION:</div>
                    <textarea class="answer-area" id="p2_1b" placeholder="1. Magnitude of warming: ...

2. Comparison to modern tropics: ...

3. Implications for marine life: ..."></textarea>
                </div>
            </div>

            <div class="question-block">
                <div class="question-title">Question 2.2: The Ice Volume Trap (10 points)</div>
                
                <p>A fellow student analyzing the same PTB dataset applies the following reasoning:</p>
                
                <div class="concept-box" style="background: #fdf2f2; border-color: #e74c3c;">
                    <em>"I know that during the Last Glacial Maximum, seawater Œ¥¬π‚Å∏O was about +1.0‚Ä∞ higher than today due to ice sheet storage of ¬π‚Å∂O. To be safe, I'll apply a +1.0‚Ä∞ ice volume correction to my PTB seawater value, changing it from -1.0‚Ä∞ to 0.0‚Ä∞ VSMOW."</em>
                </div>

                <div class="sub-question">
                    <div class="sub-question-title">Part A (5 points): Error identification</div>
                    <p>Explain why this reasoning is <strong>incorrect</strong> for the Permo-Triassic interval. What fundamental difference between the PTB world and the Quaternary makes this correction inappropriate?</p>
                    
                    <div class="calculation-label">üìù YOUR ANSWER:</div>
                    <textarea class="answer-area" id="p2_2a" placeholder="Explain why the ice volume correction is inappropriate for the PTB..."></textarea>
                </div>

                <div class="sub-question">
                    <div class="sub-question-title">Part B (5 points): Quantify the error</div>
                    <p>Using sample CON-4 (Œ¥¬π‚Å∏O_apatite = 17.5‚Ä∞), calculate the temperature using both the correct seawater assumption (-1.0‚Ä∞) and the incorrect assumption (0.0‚Ä∞). What is the temperature difference (error) introduced by the wrong assumption?</p>
                    
                    <div class="calculation-label">üíª CALCULATION:</div>
                    <textarea class="calculation-area" id="p2_2b_calc" placeholder="CORRECT calculation (Œ¥¬π‚Å∏O_sw = -1.0‚Ä∞):
T = 117.4 - 4.50 √ó (17.5 - (-1.0)) = ...

INCORRECT calculation (Œ¥¬π‚Å∏O_sw = 0.0‚Ä∞):
T = 117.4 - 4.50 √ó (17.5 - 0.0) = ...

Error = ... ¬∞C"></textarea>
                </div>
            </div>
        </div>

        <!-- PART 3: ADVANCED PROXIES -->
        <div class="section">
            <div class="section-title">PART 3: OCEAN CHEMISTRY PROXIES (20 points) ‚Äî Estimated time: 20 minutes</div>

            <div class="question-block">
                <div class="question-title">Question 3.1: Boron Isotopes and Ocean Acidification (10 points)</div>
                
                <p>The Œ¥¬π¬πB record from brachiopod calcite shows a decline from ~13.5‚Ä∞ to ~11.2‚Ä∞ across the marine extinction interval (see multi-proxy figure in Background). Boron isotopes in marine carbonates are used as a proxy for seawater pH.</p>

                <div class="equation-box">
                    <div class="equation-title">Key Relationships:</div>
                    ‚Ä¢ Boron in seawater exists as B(OH)‚ÇÉ (boric acid) and B(OH)‚ÇÑ‚Åª (borate ion)<br>
                    ‚Ä¢ The ratio B(OH)‚ÇÑ‚Åª/B(OH)‚ÇÉ is controlled by seawater pH<br>
                    ‚Ä¢ Carbonates preferentially incorporate B(OH)‚ÇÑ‚Åª<br>
                    ‚Ä¢ B(OH)‚ÇÑ‚Åª is depleted in ¬π¬πB relative to B(OH)‚ÇÉ by ~27‚Ä∞<br>
                    ‚Ä¢ Lower pH ‚Üí more B(OH)‚ÇÉ ‚Üí lower Œ¥¬π¬πB in carbonates
                </div>

                <div class="sub-question">
                    <div class="sub-question-title">Full Question (10 points)</div>
                    <p>Based on the Œ¥¬π¬πB decline observed across the PTB:</p>
                    <ol>
                        <li>Explain the chemical mechanism by which lower seawater pH leads to lower Œ¥¬π¬πB values in brachiopod shells. (5 points)</li>
                        <li>What is the likely cause of ocean acidification during the PTB? How does this link to the carbon isotope evidence? (5 points)</li>
                    </ol>
                    
                    <div class="calculation-label">üìù YOUR ANSWER:</div>
                    <textarea class="answer-area" id="p3_1" placeholder="1. Chemical mechanism of Œ¥¬π¬πB-pH relationship:
...

2. Cause of PTB ocean acidification and link to carbon isotopes:
..."></textarea>
                </div>
            </div>

            <div class="question-block">
                <div class="question-title">Question 3.2: Strontium Isotopes ‚Äî Weathering vs Provenance (10 points)</div>
                
                <p>The ‚Å∏‚Å∑Sr/‚Å∏‚Å∂Sr ratio of seawater (recorded in marine carbonates) shows an increase across the PTB interval. This is traditionally interpreted as evidence for <strong>enhanced continental weathering</strong> driven by acid rain and vegetation die-off.</p>

                <p>However, recent research suggests an alternative hypothesis: the ‚Å∏‚Å∑Sr/‚Å∏‚Å∂Sr increase could reflect a <strong>change in sediment provenance</strong> ‚Äî specifically, increased erosion of older, more radiogenic continental crust rather than an increase in overall weathering intensity.</p>

                <div class="sub-question">
                    <div class="sub-question-title">Full Question (10 points)</div>
                    <p>You are tasked with designing a test to distinguish between these two hypotheses:</p>
                    <ul>
                        <li><strong>Hypothesis A:</strong> Enhanced weathering intensity (more weathering of the same source rocks)</li>
                        <li><strong>Hypothesis B:</strong> Provenance change (weathering of different source rocks with higher ‚Å∏‚Å∑Sr/‚Å∏‚Å∂Sr)</li>
                    </ul>
                    <p>Propose <strong>ONE additional proxy or dataset</strong> that could help distinguish between these hypotheses. Explain what results you would expect under each hypothesis.</p>
                    
                    <div class="calculation-label">üìù YOUR ANSWER:</div>
                    <textarea class="answer-area" id="p3_2" placeholder="Proposed additional proxy: ...

Expected results under Hypothesis A (enhanced weathering):
...

Expected results under Hypothesis B (provenance change):
...

How this distinguishes the hypotheses:
..."></textarea>
                </div>
            </div>
        </div>

        <!-- PART 4: DATA VISUALIZATION -->
        <div class="section">
            <div class="section-title">PART 4: DATA VISUALIZATION (5 points) ‚Äî Estimated time: 10 minutes</div>

            <div class="question-block">
                <div class="question-title">Question 4.1: Plot Your Temperature Results</div>
                
                <p>Using the chart tool below, create a plot of your calculated paleotemperatures (from Question 2.1) against geological age. This will visualize the warming trend across the PTB.</p>

                <div class="chart-container">
                    <h4>üìä Temperature vs Age Plot Generator</h4>
                    
                    <div class="chart-data-input">
                        <div>
                            <label><strong>X-axis (Age in Ma):</strong></label>
                            <textarea id="chartXData" placeholder="Enter ages, one per line:
252.00
251.95
251.92
251.90
251.85">252.00
251.95
251.92
251.90
251.85</textarea>
                        </div>
                        <div>
                            <label><strong>Y-axis (Temperature in ¬∞C):</strong></label>
                            <textarea id="chartYData" placeholder="Enter your calculated temperatures, one per line:
(from Question 2.1)"></textarea>
                        </div>
                    </div>
                    
                    <button onclick="generateChart()" style="padding: 10px 25px; background: linear-gradient(135deg, #16a085, #27ae60); color: white; border: none; border-radius: 5px; cursor: pointer; font-weight: bold;">Generate Plot</button>
                    
                    <div class="chart-canvas-container">
                        <canvas id="tempChart" width="600" height="300"></canvas>
                    </div>
                    
                    <p style="margin-top: 15px; font-size: 0.9em; color: #666;"><em>Note: The X-axis shows geological age (Ma), with older ages on the left. Your plot should show increasing temperatures toward the PTB.</em></p>
                </div>

                <div class="sub-question">
                    <div class="sub-question-title">Describe your plot (5 points)</div>
                    <p>In 2-3 sentences, describe the pattern shown in your temperature plot and identify when the most rapid warming occurred.</p>
                    
                    <div class="calculation-label">üìù YOUR DESCRIPTION:</div>
                    <textarea class="answer-area" id="p4_1" placeholder="Describe the pattern in your temperature plot..."></textarea>
                </div>
            </div>
        </div>

        <!-- PART 5: MULTI-PROXY SYNTHESIS -->
        <div class="section">
            <div class="section-title">PART 5: MULTI-PROXY SYNTHESIS (20 points) ‚Äî Estimated time: 20 minutes</div>

            <div class="question-block">
                <div class="question-title">Question 5.1: Integrated Environmental Reconstruction</div>
                
                <p>Using ALL the proxy evidence you have analyzed in this exam (Œ¥¬π¬≥C, Œ¥¬π‚Å∏O/temperature, Œ¥¬π¬πB, ‚Å∏‚Å∑Sr/‚Å∏‚Å∂Sr), write a <strong>synthesis paragraph (300-400 words)</strong> reconstructing the environmental changes during the Permo-Triassic mass extinction.</p>

                <div class="info-note">
                    <strong>Your synthesis MUST address:</strong><br>
                    1. The sequence and timing of environmental changes relative to the two extinction pulses<br>
                    2. Evidence for the role of volcanism (Siberian Traps) in triggering the crisis<br>
                    3. Ocean-atmosphere interactions (warming, acidification, carbon cycle perturbation)<br>
                    4. At least ONE limitation, uncertainty, or alternative interpretation of the proxy data
                </div>

                <div class="sub-question">
                    <div class="sub-question-title">Full Synthesis (20 points)</div>
                    
                    <div class="calculation-label">üìù YOUR SYNTHESIS:</div>
                    <textarea class="answer-area" id="p5_1" style="min-height: 250px;" placeholder="Write your multi-proxy synthesis here (300-400 words)...

Structure suggestion:
- Opening: State the main environmental story
- Body: Integrate evidence from each proxy system
- Discuss timing relative to extinction pulses
- Address causation (volcanism ‚Üí environmental change ‚Üí extinction)
- Conclusion: Acknowledge limitations or uncertainties"></textarea>
                    
                    <p style="margin-top: 10px; font-size: 0.9em; color: #666;">Word count target: 300-400 words. Current count: <span id="wordCount">0</span> words</p>
                </div>
            </div>
        </div>

        <!-- Export Section -->
        <div class="export-section">
            <h3>üì§ Submit Your Exam</h3>
            <p>When you have completed all questions, click "Submit Exam" to generate your submission file.</p>
            <p style="font-size: 0.9em; color: #e74c3c;"><strong>Note:</strong> You can only submit once. Make sure all answers are complete before submitting.</p>
            
            <div class="export-buttons">
                <button class="export-btn submit" onclick="submitExam()">‚úì Submit Exam</button>
                <button class="export-btn word" onclick="exportToWord()">üìò Export to Word</button>
                <button class="export-btn copy" onclick="copyToClipboard()">üìã Copy to Clipboard</button>
            </div>
        </div>
    </div>

    <!-- Calculator -->
    <div class="calculator-container">
        <div class="calculator-panel" id="calculatorPanel">
            <div class="calc-header">
                üßÆ Isotope Calculator
            </div>
            <div class="calc-body">
                <input type="text" class="calc-display" id="calcDisplay" readonly placeholder="0">
                
                <div class="calc-tabs">
                    <button class="calc-tab active" onclick="switchCalcTab('basic')">Basic</button>
                    <button class="calc-tab" onclick="switchCalcTab('isotope')">Isotope Functions</button>
                </div>

                <div id="basicCalc">
                    <div class="calc-buttons">
                        <button class="calc-btn clear" onclick="clearCalc()">C</button>
                        <button class="calc-btn" onclick="appendCalc('(')">(</button>
                        <button class="calc-btn" onclick="appendCalc(')')">)</button>
                        <button class="calc-btn operator" onclick="appendCalc('/')">√∑</button>
                        
                        <button class="calc-btn" onclick="appendCalc('7')">7</button>
                        <button class="calc-btn" onclick="appendCalc('8')">8</button>
                        <button class="calc-btn" onclick="appendCalc('9')">9</button>
                        <button class="calc-btn operator" onclick="appendCalc('*')">√ó</button>
                        
                        <button class="calc-btn" onclick="appendCalc('4')">4</button>
                        <button class="calc-btn" onclick="appendCalc('5')">5</button>
                        <button class="calc-btn" onclick="appendCalc('6')">6</button>
                        <button class="calc-btn operator" onclick="appendCalc('-')">‚àí</button>
                        
                        <button class="calc-btn" onclick="appendCalc('1')">1</button>
                        <button class="calc-btn" onclick="appendCalc('2')">2</button>
                        <button class="calc-btn" onclick="appendCalc('3')">3</button>
                        <button class="calc-btn operator" onclick="appendCalc('+')">+</button>
                        
                        <button class="calc-btn" onclick="appendCalc('0')">0</button>
                        <button class="calc-btn" onclick="appendCalc('.')">.</button>
                        <button class="calc-btn equals" onclick="calculate()">=</button>
                    </div>
                    
                    <div style="margin-top: 10px; display: grid; grid-template-columns: repeat(3, 1fr); gap: 5px;">
                        <button class="calc-btn function" onclick="appendCalc('Math.log(')">ln</button>
                        <button class="calc-btn function" onclick="appendCalc('Math.sqrt(')">‚àö</button>
                        <button class="calc-btn function" onclick="appendCalc('**')">x^y</button>
                    </div>
                </div>

                <div id="isotopeCalc" class="isotope-functions">
                    <button class="isotope-func-btn" onclick="showIsotopeFunc('temp_phosphate')">
                        üå°Ô∏è Phosphate Temperature (L√©cuyer et al.)
                    </button>
                    <button class="isotope-func-btn" onclick="showIsotopeFunc('temp_kim')">
                        üå°Ô∏è Carbonate Temperature (Kim & O'Neil)
                    </button>
                    <button class="isotope-func-btn" onclick="showIsotopeFunc('temp_anderson')">
                        üå°Ô∏è Carbonate Temperature (Anderson & Arthur)
                    </button>
                    <button class="isotope-func-btn" onclick="showIsotopeFunc('convert_vpdb')">
                        üîÑ Convert VPDB ‚Üî VSMOW
                    </button>
                    <button class="isotope-func-btn" onclick="showIsotopeFunc('alpha')">
                        Œ± Alpha from Delta Values
                    </button>
                    
                    <!-- Phosphate Temperature -->
                    <div class="calc-input-group" id="func_temp_phosphate">
                        <h4 style="margin-top: 0;">Phosphate Temperature (L√©cuyer et al., 2013)</h4>
                        <p style="font-size: 0.85em; color: #666;">T(¬∞C) = 117.4 - 4.50 √ó (Œ¥¬π‚Å∏O_phos - Œ¥¬π‚Å∏O_water)</p>
                        <label>Œ¥¬π‚Å∏O_phosphate (‚Ä∞ VSMOW):</label>
                        <input type="number" id="phos_d18O" step="0.1" placeholder="e.g., 20.8">
                        <label>Œ¥¬π‚Å∏O_water (‚Ä∞ VSMOW):</label>
                        <input type="number" id="phos_water" step="0.1" value="-1.0" placeholder="-1.0 for ice-free">
                        <button onclick="calcPhosphateTemp()" style="width: 100%; padding: 10px; background: #16a085; color: white; border: none; border-radius: 5px; cursor: pointer;">Calculate</button>
                        <div class="calc-result" id="result_temp_phosphate"></div>
                    </div>

                    <!-- Kim & O'Neil Temperature -->
                    <div class="calc-input-group" id="func_temp_kim">
                        <h4 style="margin-top: 0;">Carbonate Temperature (Kim & O'Neil, 1997)</h4>
                        <p style="font-size: 0.85em; color: #666;">1000 ln Œ± = 18.03(10¬≥/T) - 32.42</p>
                        <label>Œ¥¬π‚Å∏O_carbonate (‚Ä∞ VPDB):</label>
                        <input type="number" id="kim_d18O_carb" step="0.1" placeholder="e.g., -3.2">
                        <label>Œ¥¬π‚Å∏O_water (‚Ä∞ VSMOW):</label>
                        <input type="number" id="kim_water" step="0.1" value="-1.0">
                        <button onclick="calcKimTemp()" style="width: 100%; padding: 10px; background: #16a085; color: white; border: none; border-radius: 5px; cursor: pointer;">Calculate</button>
                        <div class="calc-result" id="result_temp_kim"></div>
                    </div>

                    <!-- Anderson & Arthur Temperature -->
                    <div class="calc-input-group" id="func_temp_anderson">
                        <h4 style="margin-top: 0;">Carbonate Temperature (Anderson & Arthur, 1983)</h4>
                        <p style="font-size: 0.85em; color: #666;">T(¬∞C) = 16.0 - 4.14(Œ¥c - Œ¥w) + 0.13(Œ¥c - Œ¥w)¬≤</p>
                        <label>Œ¥¬π‚Å∏O_carbonate (‚Ä∞ VPDB):</label>
                        <input type="number" id="aa_d18O_carb" step="0.1" placeholder="e.g., -3.2">
                        <label>Œ¥¬π‚Å∏O_water (‚Ä∞ VSMOW ‚Üí will convert to VPDB):</label>
                        <input type="number" id="aa_water" step="0.1" value="-1.0">
                        <button onclick="calcAndersonTemp()" style="width: 100%; padding: 10px; background: #16a085; color: white; border: none; border-radius: 5px; cursor: pointer;">Calculate</button>
                        <div class="calc-result" id="result_temp_anderson"></div>
                    </div>

                    <!-- VPDB-VSMOW Conversion -->
                    <div class="calc-input-group" id="func_convert_vpdb">
                        <h4 style="margin-top: 0;">Convert VPDB ‚Üî VSMOW</h4>
                        <p style="font-size: 0.85em; color: #666;">Œ¥¬π‚Å∏O_VSMOW = 1.03091 √ó Œ¥¬π‚Å∏O_VPDB + 30.91</p>
                        <label>Input value (‚Ä∞):</label>
                        <input type="number" id="convert_value" step="0.1" placeholder="e.g., -3.2">
                        <label>Convert from:</label>
                        <select id="convert_from" style="width: 100%; padding: 8px; margin-bottom: 10px; border-radius: 5px;">
                            <option value="vpdb">VPDB ‚Üí VSMOW</option>
                            <option value="vsmow">VSMOW ‚Üí VPDB</option>
                        </select>
                        <button onclick="convertStandard()" style="width: 100%; padding: 10px; background: #16a085; color: white; border: none; border-radius: 5px; cursor: pointer;">Convert</button>
                        <div class="calc-result" id="result_convert_vpdb"></div>
                    </div>

                    <!-- Alpha Calculation -->
                    <div class="calc-input-group" id="func_alpha">
                        <h4 style="margin-top: 0;">Calculate Œ± (Fractionation Factor)</h4>
                        <p style="font-size: 0.85em; color: #666;">Œ± = (1000 + Œ¥A) / (1000 + Œ¥B)</p>
                        <label>Œ¥_A (phase A, ‚Ä∞):</label>
                        <input type="number" id="alpha_a" step="0.1" placeholder="e.g., carbonate value">
                        <label>Œ¥_B (phase B, ‚Ä∞):</label>
                        <input type="number" id="alpha_b" step="0.1" placeholder="e.g., water value">
                        <button onclick="calcAlpha()" style="width: 100%; padding: 10px; background: #16a085; color: white; border: none; border-radius: 5px; cursor: pointer;">Calculate Œ±</button>
                        <div class="calc-result" id="result_alpha"></div>
                    </div>
                </div>
            </div>
        </div>
        <button class="calculator-toggle" onclick="toggleCalculator()">üßÆ Calculator</button>
    </div>

    <!-- Loading Overlay -->
    <div class="loading-overlay" id="loadingOverlay">
        <div class="loading-box">
            <div class="spinner"></div>
            <div id="loadingText">Processing...</div>
        </div>
    </div>

    <script data-cfasync="false" src="/cdn-cgi/scripts/5c5dd728/cloudflare-static/email-decode.min.js"></script><script>
        // ========================================
        // CONFIGURATION
        // ========================================
        const CORRECT_PASSWORD = "GeochemXmas25!";
        const EXAM_TIME_MINUTES = 105; // 1 hour 45 minutes
        const GRACE_PERIOD_MINUTES = 5;
        const INSTRUCTOR_EMAIL = "luca.caracciolo@fau.de";
        
        // TIME-LOCK CONFIGURATION
        // ========================================
        // TEST TIME: December 15, 2025 at 13:00 (1 PM)
        // PRODUCTION TIME: December 16, 2025 at 16:15 (4:15 PM)
        // ========================================
        const EXAM_START_TIME = new Date('2025-12-15T13:00:00');
        // After testing, change to: new Date('2025-12-16T16:15:00')

        // ========================================
        // STATE VARIABLES
        // ========================================
        let timerInterval = null;
        let remainingSeconds = EXAM_TIME_MINUTES * 60;
        let inGracePeriod = false;
        let examSubmitted = false;
        let chartInstance = null;

        // ========================================
        // PASSWORD & INITIALIZATION
        // ========================================
        function checkPassword() {
            const input = document.getElementById('passwordInput').value;
            if (input === CORRECT_PASSWORD) {
                document.getElementById('passwordOverlay').classList.add('hidden');
                document.getElementById('mainContent').classList.add('visible');
                document.getElementById('timerBar').classList.remove('hidden');
                initExam();
            } else {
                document.getElementById('errorMessage').textContent = 'Incorrect password. Please try again.';
            }
        }

        // ========================================
        // TIME-LOCK SYSTEM
        // ========================================
        let countdownInterval = null;

        function checkTimelock() {
            const now = new Date();
            
            if (now >= EXAM_START_TIME) {
                // Time has passed - show password screen
                document.getElementById('timelockOverlay').classList.add('hidden');
                document.getElementById('passwordOverlay').classList.remove('hidden');
                if (countdownInterval) {
                    clearInterval(countdownInterval);
                }
            } else {
                // Exam not yet available - show countdown
                document.getElementById('timelockOverlay').classList.remove('hidden');
                document.getElementById('passwordOverlay').classList.add('hidden');
                updateCountdown();
                
                // Start countdown updates
                if (!countdownInterval) {
                    countdownInterval = setInterval(function() {
                        if (new Date() >= EXAM_START_TIME) {
                            checkTimelock();
                        } else {
                            updateCountdown();
                        }
                    }, 1000);
                }
            }
        }

        function updateCountdown() {
            const now = new Date();
            const diff = EXAM_START_TIME - now;
            
            if (diff <= 0) {
                document.getElementById('countdownDisplay').textContent = "Available Now!";
                return;
            }
            
            const hours = Math.floor(diff / (1000 * 60 * 60));
            const minutes = Math.floor((diff % (1000 * 60 * 60)) / (1000 * 60));
            const seconds = Math.floor((diff % (1000 * 60)) / 1000);
            
            document.getElementById('countdownDisplay').textContent = 
                String(hours).padStart(2, '0') + ':' + 
                String(minutes).padStart(2, '0') + ':' + 
                String(seconds).padStart(2, '0');
        }

        function formatStartTime() {
            const options = { 
                weekday: 'long', 
                year: 'numeric', 
                month: 'long', 
                day: 'numeric',
                hour: '2-digit',
                minute: '2-digit'
            };
            return EXAM_START_TIME.toLocaleDateString('en-US', options);
        }

        // Initialize time-lock check on page load
        document.addEventListener('DOMContentLoaded', function() {
            document.getElementById('startTimeDisplay').textContent = formatStartTime();
            checkTimelock();
        });

        function initExam() {
            // Set today's date
            document.getElementById('submissionDate').value = new Date().toISOString().split('T')[0];
            
            // Load saved data
            loadSavedData();
            
            // Start timer
            startTimer();
            
            // Setup auto-save
            setupAutoSave();
            
            // Setup word counter
            setupWordCounter();
        }

        // ========================================
        // TIMER SYSTEM
        // ========================================
        function startTimer() {
            // Check for saved time
            const savedTime = localStorage.getItem('ptb_exam_remaining_time');
            if (savedTime) {
                remainingSeconds = parseInt(savedTime);
            }

            timerInterval = setInterval(() => {
                if (examSubmitted) {
                    clearInterval(timerInterval);
                    return;
                }

                remainingSeconds--;
                localStorage.setItem('ptb_exam_remaining_time', remainingSeconds);

                updateTimerDisplay();

                if (remainingSeconds <= 0 && !inGracePeriod) {
                    // Start grace period
                    inGracePeriod = true;
                    remainingSeconds = GRACE_PERIOD_MINUTES * 60;
                    document.getElementById('timerStatus').textContent = '‚ö†Ô∏è GRACE PERIOD - Final checks only!';
                    alert('Time is up! You have 5 minutes for final checks before automatic submission.');
                } else if (remainingSeconds <= 0 && inGracePeriod) {
                    // Auto-submit
                    clearInterval(timerInterval);
                    alert('Grace period ended. Your exam will be submitted automatically.');
                    submitExam();
                }
            }, 1000);
        }

        function updateTimerDisplay() {
            const hours = Math.floor(remainingSeconds / 3600);
            const minutes = Math.floor((remainingSeconds % 3600) / 60);
            const seconds = remainingSeconds % 60;

            const display = document.getElementById('timerDisplay');
            display.textContent = `${String(hours).padStart(2, '0')}:${String(minutes).padStart(2, '0')}:${String(seconds).padStart(2, '0')}`;

            // Update styling based on time remaining
            display.classList.remove('warning', 'critical', 'grace');
            
            if (inGracePeriod) {
                display.classList.add('grace');
            } else if (remainingSeconds <= 300) { // 5 minutes
                display.classList.add('critical');
            } else if (remainingSeconds <= 900) { // 15 minutes
                display.classList.add('warning');
            }
        }

        // ========================================
        // AUTO-SAVE
        // ========================================
        function setupAutoSave() {
            const inputs = document.querySelectorAll('input, textarea');
            inputs.forEach(input => {
                input.addEventListener('input', () => {
                    localStorage.setItem(`ptb_exam_${input.id}`, input.value);
                });
            });
        }

        function loadSavedData() {
            const inputs = document.querySelectorAll('input, textarea');
            inputs.forEach(input => {
                const saved = localStorage.getItem(`ptb_exam_${input.id}`);
                if (saved) {
                    input.value = saved;
                }
            });
            updateWatermark();
        }

        // ========================================
        // WATERMARK
        // ========================================
        function updateWatermark() {
            const name = document.getElementById('studentName').value;
            const watermark = document.getElementById('watermark');
            if (name && name.length > 2) {
                watermark.textContent = name;
                watermark.classList.remove('hidden');
            } else {
                watermark.classList.add('hidden');
            }
        }

        // ========================================
        // WORD COUNTER
        // ========================================
        function setupWordCounter() {
            const synthesisArea = document.getElementById('p5_1');
            synthesisArea.addEventListener('input', () => {
                const words = synthesisArea.value.trim().split(/\s+/).filter(w => w.length > 0);
                document.getElementById('wordCount').textContent = words.length;
            });
        }

        // ========================================
        // CALCULATOR
        // ========================================
        function toggleCalculator() {
            document.getElementById('calculatorPanel').classList.toggle('active');
        }

        function switchCalcTab(tab) {
            document.querySelectorAll('.calc-tab').forEach(t => t.classList.remove('active'));
            event.target.classList.add('active');
            
            document.getElementById('basicCalc').style.display = tab === 'basic' ? 'block' : 'none';
            document.getElementById('isotopeCalc').classList.toggle('active', tab === 'isotope');
            
            // Hide all function inputs
            document.querySelectorAll('.calc-input-group').forEach(g => g.classList.remove('active'));
        }

        function appendCalc(val) {
            const display = document.getElementById('calcDisplay');
            if (display.value === '0' || display.value === 'Error') {
                display.value = val;
            } else {
                display.value += val;
            }
        }

        function clearCalc() {
            document.getElementById('calcDisplay').value = '0';
        }

        function calculate() {
            const display = document.getElementById('calcDisplay');
            try {
                display.value = eval(display.value).toFixed(4);
            } catch (e) {
                display.value = 'Error';
            }
        }

        function showIsotopeFunc(funcName) {
            document.querySelectorAll('.calc-input-group').forEach(g => g.classList.remove('active'));
            document.getElementById(`func_${funcName}`).classList.add('active');
        }

        // Phosphate Temperature
        function calcPhosphateTemp() {
            const d18O_phos = parseFloat(document.getElementById('phos_d18O').value);
            const d18O_water = parseFloat(document.getElementById('phos_water').value);
            
            if (isNaN(d18O_phos) || isNaN(d18O_water)) {
                document.getElementById('result_temp_phosphate').innerHTML = '<span style="color: red;">Please enter valid numbers</span>';
                return;
            }
            
            const T = 117.4 - 4.50 * (d18O_phos - d18O_water);
            document.getElementById('result_temp_phosphate').innerHTML = `
                <strong>Temperature = ${T.toFixed(1)} ¬∞C</strong><br>
                <small>Calculation: 117.4 - 4.50 √ó (${d18O_phos} - (${d18O_water})) = ${T.toFixed(2)}</small>
            `;
        }

        // Kim & O'Neil Temperature
        function calcKimTemp() {
            const d18O_carb_vpdb = parseFloat(document.getElementById('kim_d18O_carb').value);
            const d18O_water_vsmow = parseFloat(document.getElementById('kim_water').value);
            
            if (isNaN(d18O_carb_vpdb) || isNaN(d18O_water_vsmow)) {
                document.getElementById('result_temp_kim').innerHTML = '<span style="color: red;">Please enter valid numbers</span>';
                return;
            }
            
            // Convert carbonate to VSMOW
            const d18O_carb_vsmow = 1.03091 * d18O_carb_vpdb + 30.91;
            
            // Calculate alpha
            const alpha = (1000 + d18O_carb_vsmow) / (1000 + d18O_water_vsmow);
            
            // Solve for T: 1000 ln(Œ±) = 18.03(10¬≥/T) - 32.42
            const lnAlpha1000 = 1000 * Math.log(alpha);
            const T_kelvin = (18.03 * 1000) / (lnAlpha1000 + 32.42);
            const T_celsius = T_kelvin - 273.15;
            
            document.getElementById('result_temp_kim').innerHTML = `
                <strong>Temperature = ${T_celsius.toFixed(1)} ¬∞C</strong><br>
                <small>Œ¥¬π‚Å∏O_carb (VSMOW) = ${d18O_carb_vsmow.toFixed(2)}‚Ä∞</small><br>
                <small>Œ± = ${alpha.toFixed(5)}</small><br>
                <small>1000 ln Œ± = ${lnAlpha1000.toFixed(2)}</small>
            `;
        }

        // Anderson & Arthur Temperature
        function calcAndersonTemp() {
            const d18O_carb = parseFloat(document.getElementById('aa_d18O_carb').value);
            const d18O_water_vsmow = parseFloat(document.getElementById('aa_water').value);
            
            if (isNaN(d18O_carb) || isNaN(d18O_water_vsmow)) {
                document.getElementById('result_temp_anderson').innerHTML = '<span style="color: red;">Please enter valid numbers</span>';
                return;
            }
            
            // Convert water to VPDB scale for this equation
            const d18O_water_vpdb = (d18O_water_vsmow - 30.91) / 1.03091;
            
            const diff = d18O_carb - d18O_water_vpdb;
            const T = 16.0 - 4.14 * diff + 0.13 * Math.pow(diff, 2);
            
            document.getElementById('result_temp_anderson').innerHTML = `
                <strong>Temperature = ${T.toFixed(1)} ¬∞C</strong><br>
                <small>Œ¥¬π‚Å∏O_water (VPDB) = ${d18O_water_vpdb.toFixed(2)}‚Ä∞</small><br>
                <small>(Œ¥c - Œ¥w) = ${diff.toFixed(2)}</small><br>
                <small>T = 16.0 - 4.14(${diff.toFixed(2)}) + 0.13(${diff.toFixed(2)})¬≤ = ${T.toFixed(2)}</small>
            `;
        }

        // VPDB-VSMOW Conversion
        function convertStandard() {
            const value = parseFloat(document.getElementById('convert_value').value);
            const from = document.getElementById('convert_from').value;
            
            if (isNaN(value)) {
                document.getElementById('result_convert_vpdb').innerHTML = '<span style="color: red;">Please enter a valid number</span>';
                return;
            }
            
            let result, formula;
            if (from === 'vpdb') {
                result = 1.03091 * value + 30.91;
                formula = `${value}‚Ä∞ VPDB ‚Üí ${result.toFixed(2)}‚Ä∞ VSMOW`;
            } else {
                result = (value - 30.91) / 1.03091;
                formula = `${value}‚Ä∞ VSMOW ‚Üí ${result.toFixed(2)}‚Ä∞ VPDB`;
            }
            
            document.getElementById('result_convert_vpdb').innerHTML = `<strong>${formula}</strong>`;
        }

        // Alpha Calculation
        function calcAlpha() {
            const a = parseFloat(document.getElementById('alpha_a').value);
            const b = parseFloat(document.getElementById('alpha_b').value);
            
            if (isNaN(a) || isNaN(b)) {
                document.getElementById('result_alpha').innerHTML = '<span style="color: red;">Please enter valid numbers</span>';
                return;
            }
            
            const alpha = (1000 + a) / (1000 + b);
            const lnAlpha1000 = 1000 * Math.log(alpha);
            
            document.getElementById('result_alpha').innerHTML = `
                <strong>Œ± = ${alpha.toFixed(5)}</strong><br>
                <small>1000 ln Œ± = ${lnAlpha1000.toFixed(2)}</small>
            `;
        }

        // ========================================
        // CHART GENERATOR
        // ========================================
        function generateChart() {
            const xData = document.getElementById('chartXData').value.trim().split('\n').map(v => parseFloat(v.trim())).filter(v => !isNaN(v));
            const yData = document.getElementById('chartYData').value.trim().split('\n').map(v => parseFloat(v.trim())).filter(v => !isNaN(v));
            
            if (xData.length === 0 || yData.length === 0) {
                alert('Please enter valid data for both axes');
                return;
            }
            
            if (xData.length !== yData.length) {
                alert('X and Y data must have the same number of values');
                return;
            }
            
            const ctx = document.getElementById('tempChart').getContext('2d');
            
            if (chartInstance) {
                chartInstance.destroy();
            }
            
            // Sort by age (descending for geological convention - older on left)
            const combined = xData.map((x, i) => ({ x, y: yData[i] }));
            combined.sort((a, b) => b.x - a.x);
            
            chartInstance = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: combined.map(d => d.x.toFixed(2)),
                    datasets: [{
                        label: 'Temperature (¬∞C)',
                        data: combined.map(d => d.y),
                        borderColor: '#e74c3c',
                        backgroundColor: 'rgba(231, 76, 60, 0.1)',
                        borderWidth: 2,
                        pointRadius: 6,
                        pointBackgroundColor: '#e74c3c',
                        fill: true,
                        tension: 0.1
                    }]
                },
                options: {
                    responsive: true,
                    plugins: {
                        title: {
                            display: true,
                            text: 'Sea Surface Temperature Across the PTB',
                            font: { size: 14 }
                        },
                        legend: {
                            display: true,
                            position: 'top'
                        }
                    },
                    scales: {
                        x: {
                            title: {
                                display: true,
                                text: 'Age (Ma)'
                            },
                            reverse: false // Older ages on left
                        },
                        y: {
                            title: {
                                display: true,
                                text: 'Temperature (¬∞C)'
                            }
                        }
                    }
                }
            });
        }

        // ========================================
        // DATA COLLECTION
        // ========================================
        function collectData() {
            return {
                studentInfo: {
                    name: document.getElementById('studentName').value,
                    email: document.getElementById('studentEmail').value,
                    studentId: document.getElementById('studentId').value,
                    date: document.getElementById('submissionDate').value
                },
                part1: {
                    q1_1a: document.getElementById('p1_1a_calc').value,
                    q1_1b: document.getElementById('p1_1b').value,
                    q1_2: document.getElementById('p1_2').value
                },
                part2: {
                    q2_1a: document.getElementById('p2_1a_calc').value,
                    q2_1b: document.getElementById('p2_1b').value,
                    q2_2a: document.getElementById('p2_2a').value,
                    q2_2b: document.getElementById('p2_2b_calc').value
                },
                part3: {
                    q3_1: document.getElementById('p3_1').value,
                    q3_2: document.getElementById('p3_2').value
                },
                part4: {
                    q4_1: document.getElementById('p4_1').value
                },
                part5: {
                    q5_1: document.getElementById('p5_1').value
                },
                metadata: {
                    submissionTime: new Date().toISOString(),
                    timeRemaining: remainingSeconds,
                    inGracePeriod: inGracePeriod
                }
            };
        }

        function validateFields() {
            const required = ['studentName', 'studentEmail', 'studentId'];
            const missing = [];
            
            required.forEach(fieldId => {
                const field = document.getElementById(fieldId);
                if (!field.value.trim()) {
                    missing.push(fieldId);
                }
            });
            
            if (missing.length > 0) {
                alert('Please fill in all required student information fields.');
                return false;
            }
            return true;
        }

        // ========================================
        // SUBMIT & EXPORT
        // ========================================
        function submitExam() {
            if (!validateFields()) return;
            
            if (examSubmitted) {
                alert('You have already submitted this exam.');
                return;
            }
            
            if (!confirm('Are you sure you want to submit? You cannot change your answers after submission.')) {
                return;
            }
            
            examSubmitted = true;
            clearInterval(timerInterval);
            
            // Export to Word
            exportToWord();
            
            // Clear saved data
            localStorage.removeItem('ptb_exam_remaining_time');
            
            alert('Your exam has been submitted. Please save the generated Word document and upload it to Teams or email it to ' + INSTRUCTOR_EMAIL);
        }

        async function exportToWord() {
            if (!validateFields()) return;
            
            showLoading('Generating Word document...');
            
            try {
                const docx = window.docx;
                const { Document, Packer, Paragraph, TextRun, HeadingLevel, AlignmentType } = docx;
                const data = collectData();
                
                const children = [
                    new Paragraph({
                        text: "SEDIMENTARY GEOCHEMISTRY - EXAM SIMULATION",
                        heading: HeadingLevel.HEADING_1,
                        alignment: AlignmentType.CENTER,
                    }),
                    new Paragraph({
                        text: "Permo-Triassic Boundary Case Study",
                        alignment: AlignmentType.CENTER,
                    }),
                    new Paragraph({ text: "" }),
                    new Paragraph({
                        text: "STUDENT INFORMATION",
                        heading: HeadingLevel.HEADING_2,
                    }),
                    new Paragraph({ text: `Name: ${data.studentInfo.name}` }),
                    new Paragraph({ text: `Email: ${data.studentInfo.email}` }),
                    new Paragraph({ text: `Student ID: ${data.studentInfo.studentId}` }),
                    new Paragraph({ text: `Date: ${data.studentInfo.date}` }),
                    new Paragraph({ text: `Submission Time: ${data.metadata.submissionTime}` }),
                    new Paragraph({ text: "" }),
                ];

                // Part 1
                children.push(
                    new Paragraph({ text: "PART 1: CARBON ISOTOPES (25 points)", heading: HeadingLevel.HEADING_2 }),
                    new Paragraph({ text: "" }),
                    new Paragraph({ children: [new TextRun({ text: "Q1.1a - CIE Magnitude Calculation:", bold: true })] }),
                    new Paragraph({ text: data.part1.q1_1a || 'Not completed' }),
                    new Paragraph({ text: "" }),
                    new Paragraph({ children: [new TextRun({ text: "Q1.1b - CIE Interpretation:", bold: true })] }),
                    new Paragraph({ text: data.part1.q1_1b || 'Not completed' }),
                    new Paragraph({ text: "" }),
                    new Paragraph({ children: [new TextRun({ text: "Q1.2 - Œ¥13C_carb vs Œ¥13C_org:", bold: true })] }),
                    new Paragraph({ text: data.part1.q1_2 || 'Not completed' }),
                    new Paragraph({ text: "" })
                );

                // Part 2
                children.push(
                    new Paragraph({ text: "PART 2: OXYGEN ISOTOPES & TEMPERATURE (30 points)", heading: HeadingLevel.HEADING_2 }),
                    new Paragraph({ text: "" }),
                    new Paragraph({ children: [new TextRun({ text: "Q2.1a - Paleotemperature Calculations:", bold: true })] }),
                    new Paragraph({ text: data.part2.q2_1a || 'Not completed' }),
                    new Paragraph({ text: "" }),
                    new Paragraph({ children: [new TextRun({ text: "Q2.1b - Temperature Interpretation:", bold: true })] }),
                    new Paragraph({ text: data.part2.q2_1b || 'Not completed' }),
                    new Paragraph({ text: "" }),
                    new Paragraph({ children: [new TextRun({ text: "Q2.2a - Ice Volume Trap - Error Identification:", bold: true })] }),
                    new Paragraph({ text: data.part2.q2_2a || 'Not completed' }),
                    new Paragraph({ text: "" }),
                    new Paragraph({ children: [new TextRun({ text: "Q2.2b - Ice Volume Trap - Error Quantification:", bold: true })] }),
                    new Paragraph({ text: data.part2.q2_2b || 'Not completed' }),
                    new Paragraph({ text: "" })
                );

                // Part 3
                children.push(
                    new Paragraph({ text: "PART 3: OCEAN CHEMISTRY PROXIES (20 points)", heading: HeadingLevel.HEADING_2 }),
                    new Paragraph({ text: "" }),
                    new Paragraph({ children: [new TextRun({ text: "Q3.1 - Boron Isotopes and Ocean Acidification:", bold: true })] }),
                    new Paragraph({ text: data.part3.q3_1 || 'Not completed' }),
                    new Paragraph({ text: "" }),
                    new Paragraph({ children: [new TextRun({ text: "Q3.2 - Strontium Isotopes - Weathering vs Provenance:", bold: true })] }),
                    new Paragraph({ text: data.part3.q3_2 || 'Not completed' }),
                    new Paragraph({ text: "" })
                );

                // Part 4
                children.push(
                    new Paragraph({ text: "PART 4: DATA VISUALIZATION (5 points)", heading: HeadingLevel.HEADING_2 }),
                    new Paragraph({ text: "" }),
                    new Paragraph({ children: [new TextRun({ text: "Q4.1 - Plot Description:", bold: true })] }),
                    new Paragraph({ text: data.part4.q4_1 || 'Not completed' }),
                    new Paragraph({ text: "" })
                );

                // Part 5
                children.push(
                    new Paragraph({ text: "PART 5: MULTI-PROXY SYNTHESIS (20 points)", heading: HeadingLevel.HEADING_2 }),
                    new Paragraph({ text: "" }),
                    new Paragraph({ children: [new TextRun({ text: "Q5.1 - Integrated Environmental Reconstruction:", bold: true })] }),
                    new Paragraph({ text: data.part5.q5_1 || 'Not completed' }),
                    new Paragraph({ text: "" })
                );

                const doc = new Document({
                    sections: [{
                        children: children
                    }]
                });

                const blob = await Packer.toBlob(doc);
                const fileName = `PTB_Exam_${data.studentInfo.name.replace(/\s+/g, '_')}.docx`;
                saveAs(blob, fileName);
                
                hideLoading();
                
            } catch (error) {
                hideLoading();
                console.error('Export error:', error);
                alert('Error generating document. Please try Copy to Clipboard instead.');
            }
        }

        async function copyToClipboard() {
            if (!validateFields()) return;
            
            const data = collectData();
            let text = `SEDIMENTARY GEOCHEMISTRY - EXAM SIMULATION\n`;
            text += `Permo-Triassic Boundary Case Study\n\n`;
            text += `${'='.repeat(60)}\n`;
            text += `STUDENT INFORMATION\n`;
            text += `${'='.repeat(60)}\n`;
            text += `Name: ${data.studentInfo.name}\n`;
            text += `Email: ${data.studentInfo.email}\n`;
            text += `ID: ${data.studentInfo.studentId}\n`;
            text += `Date: ${data.studentInfo.date}\n`;
            text += `Submission: ${data.metadata.submissionTime}\n\n`;
            
            text += `${'='.repeat(60)}\n`;
            text += `PART 1: CARBON ISOTOPES (25 points)\n`;
            text += `${'='.repeat(60)}\n\n`;
            text += `Q1.1a - CIE Calculation:\n${data.part1.q1_1a || 'Not completed'}\n\n`;
            text += `Q1.1b - CIE Interpretation:\n${data.part1.q1_1b || 'Not completed'}\n\n`;
            text += `Q1.2 - Œ¥13C_carb vs Œ¥13C_org:\n${data.part1.q1_2 || 'Not completed'}\n\n`;
            
            text += `${'='.repeat(60)}\n`;
            text += `PART 2: OXYGEN ISOTOPES & TEMPERATURE (30 points)\n`;
            text += `${'='.repeat(60)}\n\n`;
            text += `Q2.1a - Temperature Calculations:\n${data.part2.q2_1a || 'Not completed'}\n\n`;
            text += `Q2.1b - Temperature Interpretation:\n${data.part2.q2_1b || 'Not completed'}\n\n`;
            text += `Q2.2a - Ice Volume Error ID:\n${data.part2.q2_2a || 'Not completed'}\n\n`;
            text += `Q2.2b - Ice Volume Error Calc:\n${data.part2.q2_2b || 'Not completed'}\n\n`;
            
            text += `${'='.repeat(60)}\n`;
            text += `PART 3: OCEAN CHEMISTRY PROXIES (20 points)\n`;
            text += `${'='.repeat(60)}\n\n`;
            text += `Q3.1 - Boron Isotopes:\n${data.part3.q3_1 || 'Not completed'}\n\n`;
            text += `Q3.2 - Strontium Isotopes:\n${data.part3.q3_2 || 'Not completed'}\n\n`;
            
            text += `${'='.repeat(60)}\n`;
            text += `PART 4: DATA VISUALIZATION (5 points)\n`;
            text += `${'='.repeat(60)}\n\n`;
            text += `Q4.1 - Plot Description:\n${data.part4.q4_1 || 'Not completed'}\n\n`;
            
            text += `${'='.repeat(60)}\n`;
            text += `PART 5: MULTI-PROXY SYNTHESIS (20 points)\n`;
            text += `${'='.repeat(60)}\n\n`;
            text += `Q5.1 - Synthesis:\n${data.part5.q5_1 || 'Not completed'}\n`;
            
            try {
                await navigator.clipboard.writeText(text);
                alert('Exam copied to clipboard!');
            } catch (error) {
                const textarea = document.createElement('textarea');
                textarea.value = text;
                document.body.appendChild(textarea);
                textarea.select();
                document.execCommand('copy');
                document.body.removeChild(textarea);
                alert('Exam copied to clipboard!');
            }
        }

        // ========================================
        // LOADING OVERLAY
        // ========================================
        function showLoading(message) {
            document.getElementById('loadingText').textContent = message;
            document.getElementById('loadingOverlay').classList.add('active');
        }

        function hideLoading() {
            document.getElementById('loadingOverlay').classList.remove('active');
        }
    </script>

</body>
</html>